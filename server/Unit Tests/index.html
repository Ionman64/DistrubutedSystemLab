<!DOCTYPE html>
<html>
<head>
<title>Distibuted Systems Unit Tests</title>
<meta charset="utf-8">
<script src="jquery-3.2.1.min.js"></script>
<script>
	RUNNING_TESTS = 0;
	URL = "127.0.0.1:6100";
	TESTS =	{
		"1":{
			test:"SENDPOST",
			url:URL + "/board",
			method:"POST",
			data: {"entry":"banana"},
			value:"banana",
			expected:{"status":"ok"},
			delay:0,
			state:null,
			complete:false,
			running:false
		},
		"2":{
			test:"SENDPOST",
			url:URL + "/board",
			method:"POST",
			data: {"entry":"banana"},
			value:"banana",
			expected:{"status":"ok"},
			delay:0,
			state:null,
			complete:false,
			running:false
		},
		"3":{
			test:"SENDPOST",
			url:URL + "/board",
			method:"POST",
			data: {"entry":"banana"},
			value:"banana",
			expected:{"status":"ok"},
			delay:0,
			complete:false,
			running:false
		}
	};
	$(document).ready(function() {
		$.ajaxSetup({
			crossOrigin:true
		});
		run_test();
	});
	function run_test() {
		$.each(TESTS, function(test_case_id, test) {
			if (RUNNING_TESTS == 0) {
				if ((!test.running) && (!test.complete)) {
					run_ajax(test_case_id);
					return;
				}
			}
		});
		setTimeout(function() {
			run_test()
		},100);
	}
	function getBoard() {
		$.ajax({
			url:URL + "/board",
			method:"GET",
			beforeSend:function() {
				RUNNING_TESTS++;
			},
			success:function(data) {
				console.log(data);
			},
			complete:function() {
				RUNNING_TESTS--;
			}
		});
	}
	function el(m) {
		return document.createElementById(m);
	}	
	function run_ajax(test_case_id) {
		console.log("Running test case" + test_case_id);
		$.ajax({
			url:TESTS[test_case_id].url,
			method:TESTS[test_case_id].method,
			data:TESTS[test_case_id].data,
			beforeSend:function() {
				TESTS[test_case_id].running = true;
				RUNNING_TESTS++;
			},
			success:function(data) {
				var tr = el("tr");
				var td = el("td");
				//TestCaseId
				td.appendChild(document.createTextNode(test_case_id));
				tr.appendChild(td);
				//Method
				td.appendChild(document.createTextNode("POST"));
				tr.appendChild(td);
				//Expected
				td.appendChild(document.createTextNode(test_case_id.value));
				tr.appendChild(td);
				//Recieved
				td.appendChild(document.createTextNode(data));
				tr.appendChild(td);
				//Passed
				var pass = "Failed";
				if (data == TESTS[test_case_id].expected) {
					pass = "PASSED";
				}
				td.appendChild(document.createTextNode(pass));
				tr.appendChild(td);
				$("#test-scripts").append(tr);
				console.log(data);
			},
			complete:function() {
				RUNNING_TESTS--;
				TESTS[test_case_id].running = false;
				TESTS[test_case_id].completed = true;
			}
		});
	}
	function modifyPost(test_case_id) {
		console.log("Modifying post " + test_case_id);
		$.ajax({
			url:"/entries/" + TESTS[test_case_id].id,
			method:"POST",
			data:{"entry":TESTS[test_case_id].value},
			beforeSend:function() {
				RUNNING_TESTS++;
			},
			success:function(data) {
				console.log(data);
			},
			complete:function() {
				RUNNING_TESTS--;
			}
		});
	}
	function deletePost(test_case_id) {
		console.log("Deleting post " + test_case_id);
		$.ajax({
			url:"/entries/" + TESTS[test_case_id].id,
			method:"DELETE",
			beforeSend:function() {
				RUNNING_TESTS++;
			},
			success:function(data) {
				console.log(data);
			},
			complete:function() {
				RUNNING_TESTS--;
			}
		});
	}	
</script>
<style>
	.table {
		width:100%;
	}
	.table th {
		text-style:bold;
	}
	.text-center {
		text-align:center;
	}
</style>
</head>	
<body>	
	<h1 class="text-center">Unit Tests</h1>
	<secton id="unit-tests-table">
		<table id="table" class="table table-stripped">
			<thead>
				<tr>
					<th>Test Case Id</th>
					<th>Method Type</th>
					<th>Expected</th>
					<th>Recieved</th>
					<th>Pass/Fail</th>
				</tr>
			</thead>
			<tbody id="test-scripts">
			
			</tbody>
		</table>
	</secton>
</body>
</html>
